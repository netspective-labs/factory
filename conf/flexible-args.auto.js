const jsTokenEvalRE = /^[a-zA-Z0-9_]+$/;
function jsTokenEvalResult(identity, discover, isTokenValid, onInvalidToken, onFailedDiscovery) {
    let result;
    if (identity.match(jsTokenEvalRE)) {
        try {
            if (Array.isArray(discover)) {
                for (const te of discover){
                    result = te(identity);
                    if (result) break;
                }
            } else {
                result = discover(identity);
            }
            if (result && isTokenValid) result = isTokenValid(result, identity);
        } catch (error) {
            result = onFailedDiscovery?.(error, identity);
        }
    } else {
        result = onInvalidToken?.(identity);
    }
    return result;
}
const jsTokenEvalResults = {};
function cacheableJsTokenEvalResult(name, discover = eval, onInvalidToken, onFailedDiscovery) {
    if (name in jsTokenEvalResults) return jsTokenEvalResults[name];
    return jsTokenEvalResult(name, discover, (value, name)=>{
        jsTokenEvalResults[name] = value;
        return value;
    }, onInvalidToken, onFailedDiscovery);
}
function* walkHooks(targets, hookNameSuppliers, discover, prepareWalkEntry) {
    const suppliers = Array.isArray(hookNameSuppliers) ? hookNameSuppliers : [
        hookNameSuppliers
    ];
    for (const target of targets){
        for (const hookNameSupplier of suppliers){
            const hookName = hookNameSupplier(target);
            if (hookName) {
                const hookDiscovered = jsTokenEvalResult(hookName, discover, (value)=>value, (name)=>{
                    console.log(`[discoverDomElemHook] '${name}' is not a token in current scope for`, target);
                    return undefined;
                });
                let hookExecArgs = {
                    target,
                    hookDiscovered,
                    hookName,
                    hookNameSupplier
                };
                if (prepareWalkEntry) {
                    const prepared = prepareWalkEntry(hookExecArgs);
                    if (!prepared) continue;
                    hookExecArgs = prepared;
                }
                const hookExecResult = hookDiscovered && typeof hookDiscovered === "function" ? hookDiscovered(hookExecArgs) : undefined;
                yield hookExecResult ?? hookExecArgs;
            }
        }
    }
}
function flexibleArgs(argsSupplier, rulesSupplier) {
    const rules = rulesSupplier ? typeof rulesSupplier === "function" ? rulesSupplier(argsSupplier) : rulesSupplier : undefined;
    const defaultArgsSupplier = rules?.defaultArgs ?? {};
    const defaultArgs = typeof defaultArgsSupplier === "function" ? defaultArgsSupplier(argsSupplier, rules) : defaultArgsSupplier;
    let args = typeof argsSupplier === "function" ? argsSupplier(defaultArgs, rules) : argsSupplier ? {
        ...defaultArgs,
        ...argsSupplier
    } : defaultArgs;
    if (rules?.argsGuard) {
        if (!rules?.argsGuard.guard(args)) {
            args = rules.argsGuard.onFailure(args, rules);
        }
    }
    let result = {
        args,
        rules
    };
    if (rules?.finalizeResult) {
        result = rules.finalizeResult(result);
    }
    return result;
}
function governedArgs(argsSupplier, rulesSupplier) {
    const result = flexibleArgs(argsSupplier, rulesSupplier);
    return result;
}
export { jsTokenEvalResult as jsTokenEvalResult };
export { cacheableJsTokenEvalResult as cacheableJsTokenEvalResult };
export { walkHooks as walkHooks };
export { flexibleArgs as flexibleArgs };
export { governedArgs as governedArgs };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZpbGU6Ly8vaG9tZS9zbnNoYWgvd29ya3NwYWNlcy9naXRodWIuY29tL3Jlc0ZhY3RvcnkvZmFjdG9yeS9saWIvY29uZi9mbGV4aWJsZS1hcmdzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGpzVG9rZW5FdmFsUkUgPSAvXlthLXpBLVowLTlfXSskLztcblxuZXhwb3J0IGludGVyZmFjZSBUb2tlbkV4cGxvcmVyPFRva2VuPiB7XG4gIChuYW1lOiBzdHJpbmcpOiBUb2tlbiB8IHVuZGVmaW5lZDtcbn1cblxuLyoqXG4gKiBqc1Rva2VuRXZhbFJlc3VsdCBmaW5kcyBmdW5jdGlvbnMsIGNsYXNzZXMsIG9yIG90aGVyIHNpbmdsZSB3b3JkICh0b2tlbilcbiAqIFwiaG9va3NcIi4gQWxsb3dzIGRlZmluaW5nIFwiaG9vayBmdW5jdGlvbnNcIiBsaWtlIDxodG1sIGxhbmc9XCJlblwiIFhZWi1hcmdzLXN1cHBsaWVyPVwieHl6QXJnc0hvb2tcIj5cbiAqIGluIERPTSBlbGVtZW50cyBvbiB0aGUgY2xpZW50IHNpZGUgb3IgZW52aXJvbm1lbnQgdmFyaWFibGVzIGhvb2tzLCBmZWF0dXJlXG4gKiBmbGFncyBob29rcywgYW5kIENMSSBhcmd1bWVudHMgaG9va3Mgb24gdGhlIHNlcnZlciBzaWRlLiBHaXZlbiBvbmUgb3IgbW9yZVxuICogXCJleHBsb3JlclwiIGZ1bmN0aW9ucyAod2hpY2ggY2FuIGJlIGFzIHNpbXBsZSBhcyBhbiBldmFsIG9yIG1vcmUgY29tcGxleCBxdWVyeVxuICogZnVuY3Rpb25zKSwgbG9vayBmb3IgaWRlbnRpdHkgYW5kLCBpZiB0aGUgaWRlbnRpdHkgKFwiWFlaLWFyZ3Mtc3VwcGxpZXJcIilcbiAqIHJlZmVyZW5jZXMgYSBKYXZhc2NyaXB0IGZ1bmN0aW9uIHJldHVybiBpdCBhcyBhIEphdmFzY3JpcHQgZnVuY3Rpb24gaW5zdGFuY2VcbiAqIHJlYWR5IHRvIGJlIGV2YWx1YXRlZC4gSWRlbnRpdHkgaXMgZW5mb3JjZWQgdG8gYmUgYSBKYXZhc2NyaXB0IHRva2VuIHBhdHRlcm5cbiAqIGZvciBzZWN1cml0eSBwdXJwb3Nlczogc2luY2UgdGhlIHRva2VuIGlzIGxpa2VseSB0byBiZSBiZSBldmFsdWF0ZWQgYnkgdGhlXG4gKiBkaXNjb3ZlcnkgZnVuY3Rpb25zIHVzaW5nIFwiZXZhbChpZGVudGl0eSlcIiB3ZSBkbyBub3QgYWxsb3cgYXJiaXRyYXJ5IGlkZW50aXR5XG4gKiB2YWx1ZXMuXG4gKiBAcGFyYW0gaWRlbnRpdHkgd2hhdCB5b3UncmUgbG9va2luZyBmb3IgKGUuZy4gYSBjbGFzcyBuYW1lLCBmdW5jdGlvbiBuYW1lLCBlbnYgdmFyIG5hbWUsIGV0Yy4pO1xuICogQHBhcmFtIGRpc2NvdmVyIGhvdyB0byBldmFsdWF0ZSBmb3IgZGlzY292ZXJ5IG9mIHRva2VuIHdpdGggJ25hbWUnICh1c3VhbGx5IGp1c3QgJ2V2YWwnIGZ1bmN0aW9uIHNjb3BlZCBieSBjYWxsZXIpXG4gKiBAcGFyYW0gaXNUb2tlblZhbGlkIHdpbGwgYmUgY2FsbGVkIGlmIGEgdG9rZW4gaXMgZm91bmQsIHlvdSBjYW4gdHJhbnNmb3JtIGl0IG9yIGVtaXQgYW4gZXZlbnRcbiAqIEBwYXJhbSBvbkludmFsaWRUb2tlbiBpZiB0aGUgZ2l2ZW4gdGV4dCBpcyBub3QgYSBzaW5nbGUgd29yZCwgY2FsbCB0aGlzIGZ1bmN0aW9uIGFuZCByZXR1cm4gaXRzIHJlc3VsdFxuICogQHBhcmFtIG9uRmFpbGVkRGlzY292ZXJ5IGluIGNhc2UgdGhlIGV2YWwgcmVzdWx0ZWQgaW4gYW4gZXhjZXB0aW9uLCBjYWxsIHRoaXMgZnVuY3Rpb24gYW5kIHJldHVybiBpdHMgcmVzdWx0XG4gKiBAcmV0dXJucyB0aGUgcmVzdWx0IG9mIGV2YWwobmFtZSkgb3IsIGlmIHRoZXJlJ3MgYW4gZXJyb3IgdGhlIHJlc3VsdCBvZiB0aGUgZXJyb3IgY2FsbGJhY2tzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBqc1Rva2VuRXZhbFJlc3VsdDxUb2tlbj4oXG4gIGlkZW50aXR5OiBzdHJpbmcsXG4gIGRpc2NvdmVyOiBUb2tlbkV4cGxvcmVyPFRva2VuPiB8IFRva2VuRXhwbG9yZXI8VG9rZW4+W10sXG4gIGlzVG9rZW5WYWxpZD86ICh2YWx1ZTogdW5rbm93biwgbmFtZTogc3RyaW5nKSA9PiBUb2tlbiB8IHVuZGVmaW5lZCxcbiAgb25JbnZhbGlkVG9rZW4/OiAobmFtZTogc3RyaW5nKSA9PiBUb2tlbiB8IHVuZGVmaW5lZCxcbiAgb25GYWlsZWREaXNjb3Zlcnk/OiAoZXJyb3I6IEVycm9yLCBuYW1lOiBzdHJpbmcpID0+IFRva2VuIHwgdW5kZWZpbmVkLFxuKSB7XG4gIGxldCByZXN1bHQ6IFRva2VuIHwgdW5kZWZpbmVkO1xuICBpZiAoaWRlbnRpdHkubWF0Y2goanNUb2tlbkV2YWxSRSkpIHtcbiAgICAvLyBwcm9jZWVkIG9ubHkgaWYgdGhlIG5hbWUgaXMgYSBzaW5nbGUgd29yZCBzdHJpbmdcbiAgICB0cnkge1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZGlzY292ZXIpKSB7XG4gICAgICAgIGZvciAoY29uc3QgdGUgb2YgZGlzY292ZXIpIHtcbiAgICAgICAgICAvLyBmaW5kIGZpcnN0IG1hdGNoaW5nIGNhbmRpZGF0ZSBhbmQgY29udGludWUgdG8gdmFsaWRpdHkgY2hlY2tcbiAgICAgICAgICByZXN1bHQgPSB0ZShpZGVudGl0eSk7XG4gICAgICAgICAgaWYgKHJlc3VsdCkgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlc3VsdCA9IGRpc2NvdmVyKGlkZW50aXR5KTtcbiAgICAgIH1cbiAgICAgIGlmIChyZXN1bHQgJiYgaXNUb2tlblZhbGlkKSByZXN1bHQgPSBpc1Rva2VuVmFsaWQocmVzdWx0LCBpZGVudGl0eSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJlc3VsdCA9IG9uRmFpbGVkRGlzY292ZXJ5Py4oZXJyb3IsIGlkZW50aXR5KTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgcmVzdWx0ID0gb25JbnZhbGlkVG9rZW4/LihpZGVudGl0eSk7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuY29uc3QganNUb2tlbkV2YWxSZXN1bHRzOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9OyAvLyBzZXJ2ZXMgYXMgYSBjYWNoZSwgc3BlZWQgdXAgbGF0ZXIgbG9va3Vwc1xuXG5leHBvcnQgZnVuY3Rpb24gY2FjaGVhYmxlSnNUb2tlbkV2YWxSZXN1bHQ8VG9rZW4+KFxuICBuYW1lOiBzdHJpbmcsXG4gIGRpc2NvdmVyID0gZXZhbCxcbiAgb25JbnZhbGlkVG9rZW4/OiAobmFtZTogc3RyaW5nKSA9PiBUb2tlbiB8IHVuZGVmaW5lZCxcbiAgb25GYWlsZWREaXNjb3Zlcnk/OiAoZXJyb3I6IEVycm9yLCBuYW1lOiBzdHJpbmcpID0+IFRva2VuIHwgdW5kZWZpbmVkLFxuKSB7XG4gIGlmIChuYW1lIGluIGpzVG9rZW5FdmFsUmVzdWx0cykgcmV0dXJuIGpzVG9rZW5FdmFsUmVzdWx0c1tuYW1lXTtcbiAgcmV0dXJuIGpzVG9rZW5FdmFsUmVzdWx0KFxuICAgIG5hbWUsXG4gICAgZGlzY292ZXIsXG4gICAgKHZhbHVlLCBuYW1lKSA9PiB7XG4gICAgICBqc1Rva2VuRXZhbFJlc3VsdHNbbmFtZV0gPSB2YWx1ZTtcbiAgICAgIHJldHVybiB2YWx1ZTsgLy8gYmUgc3VyZSB0byB2YWx1ZSwgdGhpcyBpcyB3aGF0J3MgcmV0dXJuZWQgYXMganNUb2tlbkV2YWxSZXN1bHQgcmVzdWx0XG4gICAgfSxcbiAgICBvbkludmFsaWRUb2tlbixcbiAgICBvbkZhaWxlZERpc2NvdmVyeSxcbiAgKTtcbn1cblxuLy8gd2UgZGVmaW5lIEhUTUxFbGVtZW50IGFzIGEgZ2VuZXJpYyBhcmd1bWVudCBiZWNhdXNlIERPTSBpcyBub3Qga25vd24gaW4gVHlwZXNjcmlwdFxuZXhwb3J0IGludGVyZmFjZSBXYWxrSG9va05hbWVTdXBwbGllcjxIb29rVGFyZ2V0PiB7XG4gIChlbGVtZW50OiBIb29rVGFyZ2V0KTogc3RyaW5nIHwgdW5kZWZpbmVkO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEhvb2tXYWxrRW50cnk8SG9va1RhcmdldCwgSG9vaz4ge1xuICByZWFkb25seSB0YXJnZXQ6IEhvb2tUYXJnZXQ7XG4gIHJlYWRvbmx5IGhvb2tEaXNjb3ZlcmVkPzogSG9vaztcbiAgcmVhZG9ubHkgaG9va05hbWU6IHN0cmluZztcbiAgcmVhZG9ubHkgaG9va05hbWVTdXBwbGllcjogV2Fsa0hvb2tOYW1lU3VwcGxpZXI8SG9va1RhcmdldD47XG59XG5cbmV4cG9ydCBmdW5jdGlvbiogd2Fsa0hvb2tzPEhvb2tUYXJnZXQsIEhvb2s+KFxuICB0YXJnZXRzOiBJdGVyYWJsZTxIb29rVGFyZ2V0PixcbiAgaG9va05hbWVTdXBwbGllcnM6IEl0ZXJhYmxlPFdhbGtIb29rTmFtZVN1cHBsaWVyPEhvb2tUYXJnZXQ+PixcbiAgZGlzY292ZXI6IFRva2VuRXhwbG9yZXI8SG9vaz4gfCBUb2tlbkV4cGxvcmVyPEhvb2s+W10sXG4gIHByZXBhcmVXYWxrRW50cnk/OiAoXG4gICAgc3VnZ2VzdGVkOiBIb29rV2Fsa0VudHJ5PEhvb2tUYXJnZXQsIEhvb2s+LFxuICApID0+IEhvb2tXYWxrRW50cnk8SG9va1RhcmdldCwgSG9vaz4gfCB1bmRlZmluZWQsXG4pOiBHZW5lcmF0b3I8SG9va1dhbGtFbnRyeTxIb29rVGFyZ2V0LCBIb29rPj4ge1xuICBjb25zdCBzdXBwbGllcnMgPSBBcnJheS5pc0FycmF5KGhvb2tOYW1lU3VwcGxpZXJzKVxuICAgID8gaG9va05hbWVTdXBwbGllcnNcbiAgICA6IFtob29rTmFtZVN1cHBsaWVyc107XG4gIGZvciAoY29uc3QgdGFyZ2V0IG9mIHRhcmdldHMpIHtcbiAgICBmb3IgKGNvbnN0IGhvb2tOYW1lU3VwcGxpZXIgb2Ygc3VwcGxpZXJzKSB7XG4gICAgICBjb25zdCBob29rTmFtZSA9IGhvb2tOYW1lU3VwcGxpZXIodGFyZ2V0KTtcbiAgICAgIGlmIChob29rTmFtZSkge1xuICAgICAgICBjb25zdCBob29rRGlzY292ZXJlZCA9IGpzVG9rZW5FdmFsUmVzdWx0PEhvb2s+KFxuICAgICAgICAgIGhvb2tOYW1lLFxuICAgICAgICAgIGRpc2NvdmVyLFxuICAgICAgICAgICh2YWx1ZSkgPT4gdmFsdWUgYXMgSG9vaywgLy8gVE9ETzogbmVlZCB2YWxpZGF0aW9uXG4gICAgICAgICAgKG5hbWUpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICAgICAgICBgW2Rpc2NvdmVyRG9tRWxlbUhvb2tdICcke25hbWV9JyBpcyBub3QgYSB0b2tlbiBpbiBjdXJyZW50IHNjb3BlIGZvcmAsXG4gICAgICAgICAgICAgIHRhcmdldCxcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICAgIH0sXG4gICAgICAgICk7XG4gICAgICAgIGxldCBob29rRXhlY0FyZ3M6IEhvb2tXYWxrRW50cnk8SG9va1RhcmdldCwgSG9vaz4gPSB7XG4gICAgICAgICAgdGFyZ2V0LFxuICAgICAgICAgIGhvb2tEaXNjb3ZlcmVkLFxuICAgICAgICAgIGhvb2tOYW1lLFxuICAgICAgICAgIGhvb2tOYW1lU3VwcGxpZXIsXG4gICAgICAgIH07XG4gICAgICAgIGlmIChwcmVwYXJlV2Fsa0VudHJ5KSB7XG4gICAgICAgICAgY29uc3QgcHJlcGFyZWQgPSBwcmVwYXJlV2Fsa0VudHJ5KGhvb2tFeGVjQXJncyk7XG4gICAgICAgICAgaWYgKCFwcmVwYXJlZCkgY29udGludWU7IC8vIGZpbHRlcmVkLCBkb24ndCB5aWVsZFxuICAgICAgICAgIGhvb2tFeGVjQXJncyA9IHByZXBhcmVkO1xuICAgICAgICB9XG4gICAgICAgIC8vIHJ1biB0aGUgaG9vayB3aGljaCByZWNlaXZlcyB0aGUgZGlzY292ZXJ5IHBhcmFtZXRlcnMgYW5kIGlzIGV4cGVjdGVkXG4gICAgICAgIC8vIHRvIHJldHVybiB0aGUgcGFyYW1ldGVycyBwbHVzIHdoYXRldmVyIGlzIGV4cGVjdGVkIGJ5IHRoZSBkaXNjb3ZlckRvbUVsZW1Ib29rc1xuICAgICAgICAvLyBjYWxsZXI7IGlmIGl0IHJldHVybnMgdW5kZWZpbmVkLCB0aGUgZGVmYXVsdCBob29rRXhlY0FyZ3MgKyBob29rRXhlY1Jlc3VsdFxuICAgICAgICAvLyBpcyByZXR1cm5lZFxuICAgICAgICBjb25zdCBob29rRXhlY1Jlc3VsdCA9XG4gICAgICAgICAgaG9va0Rpc2NvdmVyZWQgJiYgdHlwZW9mIGhvb2tEaXNjb3ZlcmVkID09PSBcImZ1bmN0aW9uXCJcbiAgICAgICAgICAgID8gaG9va0Rpc2NvdmVyZWQoaG9va0V4ZWNBcmdzKVxuICAgICAgICAgICAgOiB1bmRlZmluZWQ7XG5cbiAgICAgICAgLy8geWllbGQgZnJvbSBhbnkgc3VwcGxpZXIgZm91bmRcbiAgICAgICAgeWllbGQgaG9va0V4ZWNSZXN1bHQgPz8gaG9va0V4ZWNBcmdzO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG4vLyBkZW5vLWxpbnQtaWdub3JlIG5vLWVtcHR5LWludGVyZmFjZVxuZXhwb3J0IGludGVyZmFjZSBGbGV4aWJsZUFyZ3VtZW50cyB7XG59XG5cbmV4cG9ydCB0eXBlIEFyZ3VtZW50c1N1cHBsaWVyPFxuICBBcmd1bWVudHMgZXh0ZW5kcyBGbGV4aWJsZUFyZ3VtZW50cyxcbj4gPVxuICB8IFBhcnRpYWw8QXJndW1lbnRzPlxuICB8ICgoXG4gICAgZGVmYXVsdEFyZ3M/OiBBcmd1bWVudHMsXG4gICAgcnVsZXM/OiBGbGV4aWJsZUFyZ3NSdWxlczxBcmd1bWVudHM+LFxuICApID0+IFBhcnRpYWw8QXJndW1lbnRzPik7XG5cbmV4cG9ydCB0eXBlIERlZmF1bHRBcmd1bWVudHNTdXBwbGllcjxcbiAgQXJndW1lbnRzIGV4dGVuZHMgRmxleGlibGVBcmd1bWVudHMsXG4+ID1cbiAgfCBBcmd1bWVudHNcbiAgfCAoKFxuICAgIGFyZ3M/OiBBcmd1bWVudHNTdXBwbGllcjxBcmd1bWVudHM+LFxuICAgIHJ1bGVzPzogRmxleGlibGVBcmdzUnVsZXM8QXJndW1lbnRzPixcbiAgKSA9PiBBcmd1bWVudHMpO1xuXG5leHBvcnQgaW50ZXJmYWNlIEZsZXhpYmxlQXJnc0d1YXJkPFxuICBBcmd1bWVudHMgZXh0ZW5kcyBGbGV4aWJsZUFyZ3VtZW50cyxcbiAgUnVsZXMgZXh0ZW5kcyBGbGV4aWJsZUFyZ3NSdWxlczxBcmd1bWVudHM+LFxuPiB7XG4gIHJlYWRvbmx5IGd1YXJkOiAobzogdW5rbm93bikgPT4gbyBpcyBBcmd1bWVudHM7XG4gIHJlYWRvbmx5IG9uRmFpbHVyZTogKGFyZ3M6IEFyZ3VtZW50cywgcnVsZXM/OiBSdWxlcykgPT4gQXJndW1lbnRzO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEZsZXhpYmxlQXJnc1J1bGVzPFxuICBBcmd1bWVudHMgZXh0ZW5kcyBGbGV4aWJsZUFyZ3VtZW50cyxcbj4ge1xuICAvKipcbiAgICogZGVmYXVsdEFyZ3MgY2FuIGNvbWUgZnJvbSBhbnl3aGVyZSAoZXZlbiBcImhvb2tzXCIpLiBJbiBtb3N0IGNhc2VzIHRoZXkgYXJlXG4gICAqIGp1c3QgYSBzY2FsYXIgb2JqZWN0IGJ1dCB0aGV5IGNvdWxkIGJlIHNvdXJjZWQgZnJvbSBhbnl3aGVyZS4gRm9yIGV4YW1wbGUsXG4gICAqIHlvdSBjb3VsZCB1c2UganNUb2tlbkV2YWxSZXN1bHQgdG8gZHluYW1pY2FsbHkgZXZhbHVhdGUgYSB0b2tlbiBvciByZWFkXG4gICAqIHRoZSBhcmd1bWVudHMgZnJvbSBhIGZlYXR1cmUgZmxhZyBzeXN0ZW0gbGlrZSBVbmxlYXNoLCBlbnZpcm9ubWVudFxuICAgKiB2YXJpYWJsZXMsIG9yIGV2ZW4gdGhlIENMSSB0aHJvdWdoIEZsZXhpYmxlIEFyZ3VtZW50cyBBZGFwdGVycyAoRkFBcykuXG4gICAqL1xuICByZWFkb25seSBkZWZhdWx0QXJncz86IERlZmF1bHRBcmd1bWVudHNTdXBwbGllcjxBcmd1bWVudHM+O1xuXG4gIC8qKlxuICAgKiBhcmdzR3VhcmQgZ2l2ZXMgeW91ciBjb2RlIHRoZSBvcHBvcnR1bml0eSB0byB2YWxpZGF0ZSB0aGUgQXJndW1lbnRzIGFmdGVyXG4gICAqIGZpbmFsaXphdGlvbi4gSW4gY2FzZSB0aGUgZ3VhcmQgZmFpbHMsIG9uRmFpbHVyZSB3aWxsIGJlIGNhbGxlZCBhbGxvd2luZ1xuICAgKiB5b3UgdG8gcmV0dXJuIGEgZGlmZmVyZW50IHNldCBvZiByZXN1bHRzIGZyb20gYSBcImJhY2t1cFwiIHNvdXJjZS5cbiAgICovXG4gIHJlYWRvbmx5IGFyZ3NHdWFyZD86IEZsZXhpYmxlQXJnc0d1YXJkPFxuICAgIEFyZ3VtZW50cyxcbiAgICBGbGV4aWJsZUFyZ3NSdWxlczxBcmd1bWVudHM+XG4gID47XG5cbiAgLyoqXG4gICAqIGZpbmFsaXplQXJncyBhbGxvd3MgeW91ciBjb2RlIHRvIHNlZSB3aGF0J3MgYmVlbiBjb25zdHJ1Y3RlZCB3aXRoIGFsbCB0aGVcbiAgICogcnVsZXMgYW5kIGdpdmVzIG9uZSBsYXN0IG9wcG9ydHVuaXR5IHRvIHJldHVybiBkaWZmZXJlbnQgcmVzdWx0cy5cbiAgICovXG4gIHJlYWRvbmx5IGZpbmFsaXplUmVzdWx0PzogKFxuICAgIHN1Z2dlc3RlZDogRmxleGlibGVBcmdzUmVzdWx0PEFyZ3VtZW50cywgRmxleGlibGVBcmdzUnVsZXM8QXJndW1lbnRzPj4sXG4gICkgPT4gRmxleGlibGVBcmdzUmVzdWx0PFxuICAgIEFyZ3VtZW50cyxcbiAgICBGbGV4aWJsZUFyZ3NSdWxlczxBcmd1bWVudHM+XG4gID47XG59XG5cbmV4cG9ydCB0eXBlIEZsZXhpYmxlQXJnc1J1bGVzU3VwcGxpZXI8XG4gIEFyZ3VtZW50cyBleHRlbmRzIEZsZXhpYmxlQXJndW1lbnRzLFxuICBSdWxlcyBleHRlbmRzIEZsZXhpYmxlQXJnc1J1bGVzPEFyZ3VtZW50cz4sXG4+ID1cbiAgfCBGbGV4aWJsZUFyZ3NSdWxlczxBcmd1bWVudHM+XG4gIHwgKChhcmdzPzogQXJndW1lbnRzU3VwcGxpZXI8QXJndW1lbnRzPikgPT4gUnVsZXMpO1xuXG5leHBvcnQgaW50ZXJmYWNlIEZsZXhpYmxlQXJnc1Jlc3VsdDxcbiAgQXJndW1lbnRzIGV4dGVuZHMgRmxleGlibGVBcmd1bWVudHMsXG4gIFJ1bGVzIGV4dGVuZHMgRmxleGlibGVBcmdzUnVsZXM8QXJndW1lbnRzPixcbj4ge1xuICByZWFkb25seSBhcmdzOiBBcmd1bWVudHM7XG4gIHJlYWRvbmx5IHJ1bGVzPzogUnVsZXM7XG59XG5cbi8qKlxuICogRmxleGlibHkgY3JlYXRlIGFuIG9iamVjdCBmcm9tIGFuIGFyZ3VtZW50cyBzdXBwbGllciBhbmQgYSBzZXQgb2YgcnVsZXMuXG4gKiBUaGlzIGlzIG91ciBzdGFuZGFyZCBhcHByb2FjaCB0byBjb25zdHJ1Y3Rpbmcgb2JqZWN0cyBhbmQgaG9va3M7XG4gKiBhcmdzU3VwcGxpZXIgaXMgdGhlIHByaW1hcnkgb2JqZWN0IGluc3RhbmNlIGFuZCBzaG91bGQgY29udGFpbiB0aGVcbiAqIGNhbm9uaWNhbCBwcm9wZXJ0aWVzLiBXaGVuIGNlcnRhaW4gcHJvcGVydGllcyBzaG91bGQgYWx3YXlzIGJlIHByZXNlbnQsIHRoZXlcbiAqIGNhbiBiZSBzdXBwbGllZCBpbiBydWxlcy5kZWZhdWx0QXJncy5cbiAqIEBwYXJhbSBhcmdzU3VwcGxpZXJcbiAqIEBwYXJhbSBydWxlc1N1cHBsaWVyXG4gKiBAcmV0dXJuc1xuICovXG5leHBvcnQgZnVuY3Rpb24gZmxleGlibGVBcmdzPFxuICBBcmd1bWVudHMgZXh0ZW5kcyBGbGV4aWJsZUFyZ3VtZW50cyxcbj4oXG4gIGFyZ3NTdXBwbGllcjogQXJndW1lbnRzU3VwcGxpZXI8QXJndW1lbnRzPixcbiAgcnVsZXNTdXBwbGllcj86IEZsZXhpYmxlQXJnc1J1bGVzU3VwcGxpZXI8XG4gICAgQXJndW1lbnRzLFxuICAgIEZsZXhpYmxlQXJnc1J1bGVzPEFyZ3VtZW50cz5cbiAgPixcbik6IEZsZXhpYmxlQXJnc1Jlc3VsdDxcbiAgQXJndW1lbnRzLFxuICBGbGV4aWJsZUFyZ3NSdWxlczxBcmd1bWVudHM+XG4+IHtcbiAgLy8gcnVsZXMgY2FuIGNvbWUgZnJvbSBhbnl3aGVyZSAoZXZlbiBcImhvb2tzXCIpLiBJbiBtb3N0IGNhc2VzIHJ1bGVzIGFyZVxuICAvLyBqdXN0IGEgc2NhbGFyIG9iamVjdCB3aXRoIHNpbXBsZSBwcm9wZXJ0aWVzIGJ1dCB0aGV5IGNvdWxkIGJlIHNvdXJjZWRcbiAgLy8gZnJvbSBhbnl3aGVyZS4gRm9yIGV4YW1wbGUsIHlvdSBjb3VsZCB1c2UganNUb2tlbkV2YWxSZXN1bHQgdG9cbiAgLy8gZHluYW1pY2FsbHkgZXZhbHVhdGUgYSB0b2tlbiBvciByZWFkIHRoZSBydWxlcyBmcm9tIERPTSBlbGVtZW50IGhvb2tzIGlmXG4gIC8vIHJ1bm5pbmcgaW4gYSBicm93c2VyIG9yIHRocm91Z2ggZW52aXJvbm1lbnQgdmFyaWFibGVzIGlmIHJ1bm5pbmcgb24gdGhlXG4gIC8vIHNlcnZlci4gVGhlc2UgXCJob29rc1wiIGFyZSBjYWxsZWQgRmxleGlibGUgQXJndW1lbnRzIFJ1bGVzIEFkYXB0ZXJzIChGQVJBcykuXG4gIGNvbnN0IHJ1bGVzID0gcnVsZXNTdXBwbGllclxuICAgID8gKHR5cGVvZiBydWxlc1N1cHBsaWVyID09PSBcImZ1bmN0aW9uXCJcbiAgICAgID8gcnVsZXNTdXBwbGllcihhcmdzU3VwcGxpZXIpXG4gICAgICA6IHJ1bGVzU3VwcGxpZXIpXG4gICAgOiB1bmRlZmluZWQ7XG5cbiAgLy8gaWYgd2UgaGF2ZSBhIGRlZmF1bHRBcmdzIHJ1bGUsIHVzZSBpdDsgaWYgZGVmYXVsdEFyZ3MgaXMgYSBmdW5jdGlvbixcbiAgLy8gZXZhbHVhdGUgaXQgYW5kIGFzc3VtZSB0aGF0IHRob3NlIGFyZSB0aGUgYWN0dWFsIGRlZmF1bHQgYXJndW1lbnRzLlxuICAvLyBiZWNhdXNlIHRoZSByZXN1bHRpbmcgYXJncyBmcm9tIHRoaXMgZnVuY3Rpb24gY2FuIG5ldmVyIGJlIHVuZGVmaW5lIG9yXG4gIC8vIG51bGwgd2UgZGVmYXVsdCB0byBhbiBlbXB0eSBvYmplY3QgdG8gc3RhcnQgd2l0aC5cbiAgY29uc3QgZGVmYXVsdEFyZ3NTdXBwbGllciA9IHJ1bGVzPy5kZWZhdWx0QXJncyA/PyB7fTtcbiAgY29uc3QgZGVmYXVsdEFyZ3MgPSB0eXBlb2YgZGVmYXVsdEFyZ3NTdXBwbGllciA9PT0gXCJmdW5jdGlvblwiXG4gICAgPyBkZWZhdWx0QXJnc1N1cHBsaWVyKGFyZ3NTdXBwbGllciwgcnVsZXMpXG4gICAgOiBkZWZhdWx0QXJnc1N1cHBsaWVyO1xuXG4gIC8vIG5vdyB0aGF0IHdlIGhhdmUgb3VyIHJ1bGVzIGFuZCBkZWZhdWx0IGFyZ3VtZW50cyBzZXR1cCB0aGUgY2Fub25pY2FsXG4gIC8vIGFyZ3VtZW50cyBpbnN0YW5jZS4gSWYgdGhlIGFyZ3NTdXBwbGllciBpcyBhIGZ1bmN0aW9uLCBldmFsdWF0ZSBpdCBhbmRcbiAgLy8gdXNlIGl0IGFzIHRoZSBzdGFydGluZyBwb2ludC4gSWYgYXJnc1N1cHBsaWVyIGlzIGEgZnVuY3Rpb24sIGl0IG1lYW5zXG4gIC8vIHRoYXQgaXQgbWlnaHQgYmUgYSBcImhvb2tcIiBvciBvdGhlciBkeW5hbWljYWxseSBzb3VyY2VkIGNvbnRlbnQuIElmXG4gIC8vIGFyZ3NTdXBwbGllciBpcyBhIGZ1bmN0aW9uLCBpdCB3aWxsIGJlIGdpdmVuIHRoZSBkZWZhdWx0QXJncyBhcyBpdHNcbiAgLy8gZmlyc3QgcGFyYW1ldGVyIGlzIHRoZSByZXNwb25zaWJpbGl0eSBvZiB0aGUgYXJnc1N1cHBsaWVyIGZ1bmN0aW9uIHRvXG4gIC8vIHVzZSBzcHJlYWQgb3BlcmF0b3JzIHRvIFwidXNlXCIgdGhlIGRlZmF1bHRzIGJlZm9yZSByZXR1cm5pbmcgYmVjYXVzZSB0aGVcbiAgLy8gYXJnc1N1cHBsaWVyIGZ1bmN0aW9uIGlzIHJlc3BvbnNpYmxlIGZvciBpbmhlcml0aW5nIHRoZSBkZWZhdWx0IGFyZ3MuXG4gIC8vIElmIGFyZ3NTdXBwbGllciBpcyBhbiBvYmplY3QgaW5zdGFuY2UsIGRlZmF1bHRBcmdzIHdpbGwgYXV0b21hdGljYWxseVxuICAvLyBiZSBpbmhlcml0ZWQuXG4gIGxldCBhcmdzID0gdHlwZW9mIGFyZ3NTdXBwbGllciA9PT0gXCJmdW5jdGlvblwiXG4gICAgPyBhcmdzU3VwcGxpZXIoZGVmYXVsdEFyZ3MsIHJ1bGVzKVxuICAgIDogKGFyZ3NTdXBwbGllciA/IHsgLi4uZGVmYXVsdEFyZ3MsIC4uLmFyZ3NTdXBwbGllciB9IDogZGVmYXVsdEFyZ3MpO1xuXG4gIGlmIChydWxlcz8uYXJnc0d1YXJkKSB7XG4gICAgaWYgKCFydWxlcz8uYXJnc0d1YXJkLmd1YXJkKGFyZ3MpKSB7XG4gICAgICBhcmdzID0gcnVsZXMuYXJnc0d1YXJkLm9uRmFpbHVyZShhcmdzLCBydWxlcyk7XG4gICAgfVxuICB9XG5cbiAgbGV0IHJlc3VsdDogRmxleGlibGVBcmdzUmVzdWx0PFxuICAgIEFyZ3VtZW50cyxcbiAgICBGbGV4aWJsZUFyZ3NSdWxlczxBcmd1bWVudHM+XG4gID4gPSB7IGFyZ3MsIHJ1bGVzIH07XG5cbiAgaWYgKHJ1bGVzPy5maW5hbGl6ZVJlc3VsdCkge1xuICAgIHJlc3VsdCA9IHJ1bGVzLmZpbmFsaXplUmVzdWx0KHJlc3VsdCk7XG4gIH1cblxuICAvLyBUT0RPOiBhZGQgZXZlbnQgZW1pdHRlciB0byBydWxlcyBhbmQgYWxsb3cgXCJwdWJsaXNoXCIgb2YgYXJndW1lbnRzXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnb3Zlcm5lZEFyZ3M8XG4gIEFyZ3VtZW50cyBleHRlbmRzIEZsZXhpYmxlQXJndW1lbnRzLFxuPihcbiAgYXJnc1N1cHBsaWVyOiBBcmd1bWVudHNTdXBwbGllcjxBcmd1bWVudHM+LFxuICBydWxlc1N1cHBsaWVyPzogRmxleGlibGVBcmdzUnVsZXNTdXBwbGllcjxcbiAgICBBcmd1bWVudHMsXG4gICAgRmxleGlibGVBcmdzUnVsZXM8QXJndW1lbnRzPlxuICA+LFxuKSB7XG4gIGNvbnN0IHJlc3VsdCA9IGZsZXhpYmxlQXJncyhhcmdzU3VwcGxpZXIsIHJ1bGVzU3VwcGxpZXIpO1xuICAvLyBUT0RPOiBhZGQgaHR0cHM6Ly9hanYuanMub3JnLyBzY2hl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
